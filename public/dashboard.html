<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root {
  --bg: #f9fafb;
  --card: #ffffff;
  --primary: #2563eb;
  --primary-hover: #1d4ed8;
  --danger: #dc2626;
  --text: #0f172a;
  --muted: #6b7280;
  --border: #e5e7eb;
  --success: #16a34a;
}

[data-theme="dark"] {
  --bg: #020617;
  --card: #020617;
  --text: #e5e7eb;
  --muted: #94a3b8;
  --border: #1e293b;
}

* {
  box-sizing: border-box;
  font-family: system-ui, sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  padding: 16px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 520px;
  margin: 0 auto 20px;
}

.header-actions {
  display: flex;
  gap: 8px;
}

button {
  border-radius: 12px;
  border: none;
  padding: 10px 14px;
  font-weight: 600;
  cursor: pointer;
}

.logout { background: var(--danger); color: #fff; }
.toggle { background: #f1f5f9; }

.card {
  background: var(--card);
  border-radius: 18px;
  padding: 22px;
  border: 1px solid var(--border);
  box-shadow: 0 12px 30px rgba(0,0,0,0.06);
  max-width: 520px;
  margin: auto;
}

.avatar {
  width: 72px;
  height: 72px;
  border-radius: 50%;
  background: var(--primary);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8rem;
  font-weight: 700;
  margin-bottom: 12px;
}

label {
  margin-top: 14px;
  display: block;
  font-size: 0.85rem;
  color: var(--muted);
}

input {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid var(--border);
  margin-top: 6px;
  background: transparent;
  color: var(--text);
}

input[disabled] {
  opacity: 0.6;
}

.badge {
  margin-top: 10px;
  display: inline-block;
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 0.75rem;
  background: #eef2ff;
  color: var(--primary);
  font-weight: 600;
}

.row {
  display: flex;
  gap: 10px;
  margin-top: 18px;
}

.save { flex: 1; background: var(--primary); color: #fff; }
.refresh { border: 1px solid var(--border); background: transparent; }

.section {
  margin-top: 26px;
  padding-top: 18px;
  border-top: 1px dashed var(--border);
}

.section h3 {
  margin: 0 0 10px;
  font-size: 1rem;
}

.meta {
  font-size: 0.8rem;
  color: var(--muted);
}

.danger-zone h3 { color: var(--danger); }

.delete-btn {
  background: #fee2e2;
  color: var(--danger);
  width: 100%;
  margin-top: 10px;
}

.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--card);
  border: 1px solid var(--border);
  padding: 12px 16px;
  border-radius: 12px;
  font-size: 0.85rem;
  box-shadow: 0 10px 25px rgba(0,0,0,.15);
  display: none;
}

.toast.success { color: var(--success); }
.toast.error { color: var(--danger); }
</style>
</head>

<body>
<div class="header">
  <h1>Dashboard</h1>
  <div class="header-actions">
    <button class="toggle" onclick="toggleTheme()">ðŸŒ“</button>
    <button class="logout" onclick="logout()">Logout</button>
  </div>
</div>

<div id="content" class="card">Loadingâ€¦</div>
<div id="toast" class="toast"></div>

<script>
const content = document.getElementById("content");
const toast = document.getElementById("toast");

function showToast(msg, type="success") {
  toast.textContent = msg;
  toast.className = `toast ${type}`;
  toast.style.display = "block";
  setTimeout(() => toast.style.display = "none", 2500);
}

function toggleTheme() {
  const theme = document.documentElement.dataset.theme === "dark" ? "" : "dark";
  document.documentElement.dataset.theme = theme;
  localStorage.setItem("theme", theme);
}

document.documentElement.dataset.theme = localStorage.getItem("theme") || "";

async function loadProfile() {
  const res = await fetch("/auth/me");
  if (!res.ok) return location.href = "/login.html";

  const { user } = await res.json();
  const initial = (user.name || user.email)[0].toUpperCase();
  const provider = user.provider === "google" ? "Google Account" : "Email & Password";

  content.innerHTML = `
    <div class="avatar">${initial}</div>

    <label>Name</label>
    <input id="name" value="${user.name || ""}">

    <label>Email</label>
    <input value="${user.email}" disabled>

    <span class="badge">${provider}</span>

    <div class="meta">
      <div>Account created: ${new Date(user.created_at).toLocaleDateString()}</div>
      <div>Last login: ${new Date(user.last_login).toLocaleString()}</div>
    </div>

    <div class="row">
      <button class="save" onclick="saveProfile()">Save</button>
      <button class="refresh" onclick="loadProfile()">Refresh</button>
    </div>

    <div class="section">
      <h3>Security</h3>
      ${user.provider === "local" ? `
        <button class="refresh" onclick="changePassword()">Change Password</button>
      ` : `<div class="meta">Managed by Google</div>`}
    </div>

    <div class="section danger-zone">
      <h3>Danger Zone</h3>
      <button class="delete-btn" onclick="confirmDelete()">Delete Account</button>
    </div>
  `;
}

async function saveProfile() {
  const name = document.getElementById("name").value.trim();
  const res = await fetch("/auth/profile", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name })
  });

  res.ok ? showToast("Profile updated") : showToast("Update failed", "error");
}

function changePassword() {
  showToast("Password reset email sent");
}

async function confirmDelete() {
  if (!confirm("This will permanently delete your account. Continue?")) return;
  const res = await fetch("/auth/delete", { method: "POST" });
  res.ok ? location.href = "/" : showToast("Delete failed", "error");
}

async function logout() {
  await fetch("/auth/logout", { method: "POST" });
  location.href = "/login.html";
}

loadProfile();
</script>
</body>
</html>
